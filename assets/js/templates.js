riot.tag2("root-main",'<section-nav></section-nav> <section-content id="content"></section-content> <section-loader></section-loader> <section-loader-ajax></section-loader-ajax> <section-alert></section-alert> <section-notify></section-notify> <ui-dropmenu></ui-dropmenu>',"",'id="app"',function(t){$root=this,this.on("mount",function(){app.$dom.root=$$($root.root),app.$dom.content=app.$dom.root.find("#content"),$Nav=$root.tags["section-nav"],$Loader=$root.tags["section-loader"],$LoaderAjax=$root.tags["section-loader-ajax"],$Alert=$root.tags["section-alert"],$Notify=$root.tags["section-notify"],$DropMenu=$root.tags["ui-dropmenu"],app.router.init()})}),riot.tag2("section-alert",'<div class="alert__wrapper"> <div class="alert__header"> <h3 class="alert__title">{data.title}</h3> <p if="{data.subtitle}" class="alert__subtitle">{data.subtitle}</p> </div> <div class="alert__buttons"> <div onclick="{onCancel}" class="alert__button {alert__button--active : data.button === ⁗cancel⁗}">{data.cancel && data.cancel.title ? data.cancel.title : ⁗Отмена⁗}</div> <div onclick="{onSuccess}" class="alert__button {alert__button--active : data.button === ⁗success⁗}">{data.success && data.success.title ? data.success.title : ⁗OK⁗}</div> </div> </div>',"",'class="alert" data-open="{active}"',function(t){var e=this;$$(e.root);e.active=!1,e.data={title:null,subtitle:null},e.show=function(t){t&&(e.data=t,e.active=!0,e.update())},e.onSuccess=function(){e.data.success&&"function"==typeof e.data.success.callback&&e.data.success.callback(),e.data.button="success",e.active=!1},e.onCancel=function(){e.data.cancel&&"function"==typeof e.data.cancel.callback&&e.data.cancel.callback(),e.data.button="cancel",e.active=!1}}),riot.tag2("section-loader","","",'class="loader" data-show="{active}"',function(t){var e=this;e.active=!1,e.show=function(){return e.update({active:!0}),new Promise(function(t,o){_.onEndTransition(e.root,function(){return t()})})},e.hide=function(){e.update({active:!1})}}),riot.tag2("section-loader-ajax",'<div class="loader-ajax-spinner"></div>',"",'class="loader-ajax" data-show="{active}"',function(t){var e=this;e.active=!1,e.show=function(){e.update({active:!0})},e.hide=function(){e.update({active:!1})}}),riot.tag2("section-notify",'<div onclick="{hide}" name="notify" class="notify {opts.size ? \'notify-\' + opts.size : \'notify-m\'}" data-color="{opts.color ? opts.color : ⁗primary⁗}" riot-style="max-width:{opts.maxWidth ? opts.maxWidth : \'380px\'} {opts.width ? \'width:\' + opts.width : null}">{opts.text}</div>',"",'class="notify-wrapper" data-active="{active}" data-pos="{opts.pos ? opts.pos : ⁗top-left⁗}"',function(t){var e=this;e.active=!1,e.timeout=2,e.interval=null,e.opts={pos:"top-left"},e.on("mount",function(){setTimeout(function(){e.root.style.display="block"},20)}),e.show=function(t){return clearTimeout(e.interval),"undefined"==typeof t.timeout&&(t.color||(t.timeout=1)),e.active&&e.autoHide(t),t.pos!=e.opts.pos?(e.update({opts:t}),setTimeout(function(){e.update({active:!0})},200)):e.update({opts:t,active:!0}),new Promise(function(o,s){_.onEndTransition(e.notify,function(){return e.autoHide(t),o()})})},e.autoHide=function(t){t.timeout!==!1&&(e.interval=setTimeout(function(){e.hide()},t.timeout?1e3*t.timeout:1e3*e.timeout))},e.hide=function(){e.update({active:!1})}}),riot.tag2("oscreen-loader",'<div class="oScreen__loader__progress" riot-style="width:{status}%" data-anim="{animate}"></div> <div class="oScreen__loader__spinner"></div>',"",'class="oScreen__loader"',function(t){var e=this;e.active=!1,e.status=0,e.animate=!1,e.progress=null,e.show=function(t){t&&!e.active&&(e.active=!0,e.start=t.start||$$.noop,e.end=t.end||$$.noop,e.callback=t.callback||$$.noop,e.scope=$$(t.scope)[0],e.reset(),e.parent.update({loading:!0}),app.device.isMobile&&e.update({animate:!0}),e.start(),_.onEndTransition(e.scope,function(){t.resources?app.loader.resources(t.resources,e.onResourcesLoaded,function(){e.status+=25/t.resources.length,e.updateLoading()}):(e.status+=25,e.onResourcesLoaded(),e.updateLoading()),$afterlag.run(function(){_.isFunction(t.tag)?(e.html=t.tag(),e.html.one("updated",function(){$afterlag.run(function(){e.onHtmlLoaded(t.content)})})):e.onHtmlLoaded(t.content)})}))},e.init=function(){e.progress.resources&&e.progress.images&&e.progress.html&&(e.status=100,e.updateLoading(),setTimeout(e.hide,175))},e.onImagesLoaded=function(){e.progress.images=!0,e.init()},e.onImagesItemLoaded=function(t,o){e.status+=25/o,e.updateLoading()},e.onResourcesLoaded=function(){e.progress.resources=!0,e.animate=!0,e.init()},e.onHtmlLoaded=function(t){e.progress.html=!0,e.status+=50,e.animate=!1,e.updateLoading(),app.loader.images($$(t),e.onImagesLoaded,e.onImagesItemLoaded),e.init()},e.hide=function(){e.parent.update({loading:!1,active:!0}),e.end(),_.onEndTransition(e.scope,function(){e.callback()}),e.reset()},e.reset=function(){e.progress={resources:!1,images:!1,html:!1},e.update({status:0})},e.updateLoading=function(){e.update()}}),riot.tag2("products-search",'<div class="products__search__list__wrapper"> <input type="text" name="selectfield" class="input input-m" placeholder="{opts.tags.placeholder}" onkeydown="{navigate}" oninput="{filterOptions}" onfocus="{open}" readonly="{!opts.tags.filter}"> <ul class="products__search__list" if="{opts.tags.isvisible && options.length}"> <li each="{options}" no-reorder onclick="{parent.select}" class="products__search__list__item" data-selected="{selected}" data-active="{active}"> <div class="products__search__list__item__article">{article}</div> <div class="products__search__list__item__name">{title}</div> </li> </ul> </div>',"",'class="products__search"',function(t){function e(){var t=window,e=document,o=e.documentElement,s=e.getElementsByTagName("body")[0],i=t.innerWidth||o.clientWidth||s.clientWidth,a=t.innerHeight||o.clientHeight||s.clientHeight;return{width:i,height:a}}var o=this;t.tags||(t.tags={options:[],tags:[]}),t.tags.options||(t.tags.options=[]);var s=function(e){!o.root.contains(e.target)&&t.tags.isvisible&&(o.close(),o.update())},i=function(){o.selectfield.value="";for(var e=0;e<t.tags.options.length;e++){t.tags.options[e]}};o.filterOptions=function(){o.selectfield.value.length?t.tags.isvisible=!0:t.tags.isvisible=!1,o.options=t.tags.options,t.tags.filter&&(o.options=o.options.filter(function(e){var s=e[t.tags.filter];return s&&s.toLowerCase().indexOf(o.selectfield.value.toLowerCase())>-1})),o.options.length>10&&(o.options=o.options.splice(0,9)),o.trigger("filter",o.selectfield.value)};var a=function(){var s=e(),i=o.root.querySelector(".menu");if(i){if(!t.tags.isvisible)return i.style.marginTop="",void(i.style.marginLeft="");var a=i.getBoundingClientRect();s.width<a.left+a.width&&(i.style.marginLeft=s.width-(a.left+a.width)-20+"px"),a.left<0&&(i.style.marginLeft="20px"),s.height<a.top+a.height&&(i.style.marginTop=s.height-(a.top+a.height)-20+"px")}};o.navigate=function(e){if([13,38,40].indexOf(e.keyCode)>-1&&!t.tags.isvisible)return e.preventDefault(),o.open(),!0;var s=o.options.length;if(s>0&&[13,38,40].indexOf(e.keyCode)>-1){e.preventDefault();for(var i=null,a=0;a<s;a++){var n=o.options[a];if(n.active){i=a;break}}null!=i&&(o.options[i].active=!1),38==e.keyCode?null==i||0==i?o.options[s-1].active=!0:o.options[i-1].active=!0:40==e.keyCode?null==i||i==s-1?o.options[0].active=!0:o.options[i+1].active=!0:13==e.keyCode&&null!=i&&o.select({item:o.options[i]})}return!0},o.open=function(){o.selectfield.value.length&&(t.tags.isvisible=!0),o.trigger("open")},o.close=function(){t.tags.isvisible&&(t.tags.isvisible=!1,o.trigger("close"))},o.select=function(t){i(),o.filterOptions(),o.trigger("select",t.item)},o.on("mount",function(){i(),o.filterOptions(),document.addEventListener("click",s),o.update()}),o.on("update",function(){t.tags.filter||i(),a()}),o.on("unmount",function(){document.removeEventListener("click",s)})}),riot.tag2("share-button",'<div class="shareButton__opener"></div> <div class="shareButton__items"> <div class="shareButton__item" data-share="fb" data-balloon="Поделиться в Facebook" data-balloon-color="blue"> <icon-fb></icon-fb> </div> <div class="shareButton__item" data-share="vk" data-balloon="Поделиться в ВКонтакте" data-balloon-pos="left" data-balloon-color="blue"> <icon-vk></icon-vk> </div> <div class="shareButton__item" data-share="tw" data-balloon="Поделиться в Twitter" data-balloon-pos="left" data-balloon-color="blue"> <icon-tw></icon-tw> </div> <div class="shareButton__item" data-share="dk" data-balloon="Поделиться в Одноклассниках" data-balloon-pos="left" data-balloon-color="blue"> <icon-dk></icon-dk> </div> </div>',"",'class="shareButton" data-pos="{opts.pos}"',function(t){}),riot.tag2("section-tutorial",'<div class="tutorial__shape" name="shape" riot-style="{step.style}"></div> <div name="msgBox" class="tutorial__message__wrapper" riot-style="{message.style}"> <div name="msgElem" class="tutorial__message" data-position="{message.position}" data-active="false"> <p class="pos-tr p-m c-grayLight fontSize-m">Шаг {num} из {steps.get().length}</p> <div class="tutorial__message__title">{message.title}</div> <p class="tutorial__message__text">{message.text}</p> <div class="fontSize-0"> <button onclick="{nextStep}" onupdate="none" class="btn btn-m {endShow ? \'btn-success\' : \'btn-default-hover-success\'} mr-xs"> <svg if="{endShow}" class="btn-svg btn-svg-repeat" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 50 50"> <path class="fill-white" d="M 39.78125 5.96875 A 2.0002 2.0002 0 0 0 38 8 L 38 12.5625 C 34.722701 9.1373523 30.10346 7 25 7 C 15.082241 7 7 15.082241 7 25 A 2.0002 2.0002 0 1 0 11 25 C 11 17.243759 17.243759 11 25 11 C 28.816123 11 32.256876 12.535728 34.78125 15 L 31 15 A 2.0002 2.0002 0 1 0 31 19 L 40 19 L 42 19 L 42 17 L 42 8 A 2.0002 2.0002 0 0 0 39.96875 5.96875 A 2.0002 2.0002 0 0 0 39.78125 5.96875 z M 40.78125 22.96875 A 2.0002 2.0002 0 0 0 39 25 C 39 32.757363 32.756392 39 25 39 C 21.184399 39 17.742551 37.46305 15.21875 35 L 19 35 A 2.0002 2.0002 0 1 0 19 31 L 10 31 L 8 31 L 8 33 L 8 42 A 2.0002 2.0002 0 1 0 12 42 L 12 37.4375 C 15.276425 40.860887 19.895994 43 25 43 C 34.917608 43 43 34.918637 43 25 A 2.0002 2.0002 0 0 0 40.96875 22.96875 A 2.0002 2.0002 0 0 0 40.78125 22.96875 z"></path> </svg> {endShow ? \'Повторить\' : \'Далее\'} </button> <button onclick="{hide}" class="btn btn-m btn-primary-hover">{endShow ? \'Перейти к выбору\' : \'Выйти из обзора\'}</button> </div> </div> </div>',"",'class="tutorial" data-open="{active}" active-zone="{step.activeZone}"',function(t){var e=this;e.active=!1,e.ready=!1,e.steps=new Baobab([]).root,e.borderColor="#0084ff",e.on("before-mount",function(){e.reset()}),e.on("messageShow",function(){e.message.active||(e.message.active=!0,_.onEndTransition(e.shape,function(){e.cordsMsg(),e.update(),e.msgElem.setAttribute("data-active",!0),_.onEndTransition(e.msgElem,function(){e.ready=!0})}))}),e.on("messageHide",function(){e.message.active=!1,e.msgElem.setAttribute("data-active",!1),_.onEndTransition(e.msgElem,function(){e.message.position=e.step.position,e.message.title=e.step.title,e.message.text=e.step.text,e.update()})}),e.reset=function(){e.start=!1,e.scope=null,e.message={active:!1,style:"clear:both",position:null,title:null,text:null},e.cursor=null,e.target=null,e.num=0,e.step={activeZone:!1,style:"clear:both"},e.endShow=!1},e.show=function(t,o){if(app.plugins.tutorial[o]){e.start=!0,e.steps.set(app.plugins.tutorial[o]),e.scope=$$(t),e.active=!0,e.trigger("messageHide"),e.nextStep();var s=_.debounce(e.render,100);app.$dom.window.on("resize.tutorial",function(){s()}),e.navigate.init()}else console.log("Not found tutorial: "+o)},e.nextStep=function(){e.changeStep("right")},e.prevStep=function(){e.num>1&&e.changeStep("left")},e.changeStep=function(t){e.ready=!1,e.cursor?e.trigger("messageHide"):e.trigger("messageShow"),e.endShow&&e.step.actions&&e.step.actions.toggle&&e.step.actions.toggle(e.target),e.cursor&&e.cursor[t]()?(e.actions(e.step,e.target,!0),e.cursor=e.cursor[t]()):e.cursor=e.steps.down(),e.step=e.cursor.get().call(),e.target=e.scope.find(e.step.target),e.start&&(e.message.position=e.step.position,e.message.title=e.step.title,e.message.text=e.step.text),e.render(),e.afterlag(function(){e.trigger("messageShow"),e.cursor[t]()||"right"!=t?e.endShow=!1:e.endShow=!0,e.update(),e.start||e.steps.get().length==e.num&&"right"==t?e.num=1:("right"==t&&e.num++,"left"==t&&e.num--),e.actions(e.step,e.target),e.start=!1})},e.render=function(){e.offset=e.target.offset(),e.step.offset&&(e.offset.top+=e.step.offset.top?e.step.offset.top:0,e.offset.left+=e.step.offset.left?e.step.offset.left:0);var t=e.target.data("width")||e.step.width,o=e.target.data("height")||e.step.height,s=e.target.data("zoom")||e.step.zoom,i=e.target.data("padding")||e.step.padding,a=t?parseInt(t):i?e.target.outerWidth()+2*parseInt(i):e.target.outerWidth(),n=o?parseInt(o):i?e.target.outerHeight()+2*parseInt(i):e.target.outerHeight(),c=s?parseFloat(s):1,l=300,r=l/2,d=(i?e.offset.left-parseInt(i):e.offset.left)+a/2,p=(i?e.offset.top-parseInt(i):e.offset.top)+n/2,u=d-r,g=p-r,m=a/l*c,v=n/a*l*c,h=Math.ceil(5/m),_=5*h,f=1e4+20/m,b=1.008*f,w=null;if("square"==e.step.figure)g=p-v/2,w="-webkit-transform: translateX("+u+"px) translateY("+g+"px) translateZ(0) scale("+m+"); transform: translateX("+u+"px) translateY("+g+"px) translateZ(0) scale("+m+"); width: "+l+"px; height: "+v+"px; box-shadow: inset 0 0 0 "+h+"px "+e.borderColor+", inset 0 0 "+_+"px rgba(0,0,0,0.4); border-radius: "+f+"px";else if("circle"==e.step.figure){var k=Math.sqrt(2)*Math.max(a,n)/2,y=2*k,x=y/l*c,h=Math.ceil(5/x),_=5*h;w="-webkit-transform: translateX("+u+"px) translateY("+g+"px) translateZ(0) scale("+x+"); transform: translateX("+u+"px) translateY("+g+"px) translateZ(0) scale("+x+"); width: "+l+"px; height: "+l+"px; box-shadow: inset 0 0 0 "+h+"px "+e.borderColor+", inset 0 0 "+_+"px rgba(0,0,0,0.4); border-radius: "+b+"px"}e.step.style=w,e.targetWidth=a,e.targetHeight=n},e.cordsMsg=function(){var t=e.offset.top;t+e.msgBox.scrollHeight>app.sizes.height-40&&(t=e.offset.top+(app.sizes.height-40)-(t+e.msgBox.scrollHeight)),t<40&&(t=40),"right"==e.step.position?e.message.style="top:"+t+"px; left:"+(e.offset.left+e.targetWidth)+"px":"left"==e.step.position||"up"==e.step.position?e.message.style="top:"+t+"px; left:"+e.offset.left+"px":"down"==e.step.position&&(e.message.style="top:"+(e.offset.top+e.targetHeight)+"px; left:"+e.offset.left+"px")},e.actions=function(t,o,s){t.actions&&t.actions.toggle&&e.afterlag(function(){t.actions.toggle(o)},{delay:s?0:650,iterations:s?0:5})},e.navigate={init:function(){app.$dom.document.on("keydown.tutorial",function(t){e.ready&&(t.which!=KEY.RIGHT||e.endShow?t.which==KEY.LEFT&&e.prevStep():e.nextStep())})},destroy:function(){app.$dom.document.off("keydown.tutorial")}},e.hide=function(){e.active=!1,_.onEndTransition(e.root,function(){e.reset(),e.update()}),e.afterlag(function(){e.actions(e.step,e.target,!0)}),e.navigate.destroy(),app.$dom.window.off("resize.tutorial")},e.afterlag=function(t,e){var o={delay:0,iterations:1};e&&_.extend(o,e);var s=new Afterlag(o);s.run(t)}}),riot.tag2("section-nav",'<div class="container"> <div class="row pos-rel"> <div class="col-md-4"> <a href="#/" class="nav__item" data-active="{$Router.section == ⁗products⁗}"> <span>Товары</span> </a> </div> <div class="col-md-4"> <a href="#/packages" class="nav__item" data-active="{$Router.section == ⁗packages⁗}"> <span>Наборы</span> </a> </div> <div class="col-md-4"> <a href="#/orders" class="nav__item" data-active="{$Router.section == ⁗orders⁗}"> <span>Заказы</span> </a> </div> <div class="col-md-4"> <a href="#/offers" class="nav__item" data-active="{$Router.section == ⁗offers⁗}"> <span>Офферы</span> </a> </div> <div class="col-md-4"> <a href="#/managers" class="nav__item" data-active="{$Router.section == ⁗managers⁗}"> <span>Менеджеры</span> </a> </div> <div class="col-md-4"> <a target="_blank" href="/#podbor" class="nav__item"> <span class="c-blueDark">Подбор</span> </a> </div> <a href="#/" class="nav__profile"></a> </div> </div>',"",'class="nav"',function(t){}),riot.tag2("btn-plus",'<svg class="btn-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewbox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve"><path class="btn-svg-color" d="M87.754,45.284H54.716V12.246c0-2.605-2.111-4.716-4.716-4.716c-1.302,0-2.481,0.528-3.334,1.382 c-0.853,0.853-1.381,2.032-1.382,3.334v33.038l-33.038,0c-1.302,0-2.481,0.528-3.334,1.382C8.058,47.519,7.53,48.698,7.53,50 c0,2.605,2.111,4.716,4.716,4.716l33.038,0l0,33.038c0,2.605,2.111,4.716,4.716,4.716c2.604,0,4.716-2.112,4.716-4.716l0-33.038 h33.038c2.604,0,4.716-2.112,4.716-4.716C92.47,47.395,90.359,45.284,87.754,45.284z"></path></svg>{opts.content}',"","class=\"btn btn-{opts.size ? opts.size : 'm'} btn-{opts.color ? opts.color : 'primary-hover'}\"",function(t){}),riot.tag2("ui-checkbox",'<label onclick="{onClick}" onupdate="{opts.onupdate ? opts.onupdate : ⁗self⁗}" class="checkbox {small : typeof opts.small !== \'undefined\'}" data-color="{opts.theme}"> <input type="checkbox" checked="{value}"> <span class="checkbox-control"></span> <span class="checkbox-text fontSize-{opts.size ? opts.size : \'m\'} {opts.color ? \'c-\' + opts.color : null}">{opts.title}</span> </label>',"","",function(t){var e=this,o=!1;e.on("before-mount",function(){if(e.opts.update&&e.opts.cursor)if(e.opts.group){var t=e.opts.cursor.get(e.opts.update);e.value=t==e.opts.value}else e.value=e.opts.cursor.get(e.opts.update);else e.opts.update||(void 0===e.opts.value?e.opts.value=e.value=!1:e.value=e.opts.value)}),e.on("update",function(){o||(!e.opts.group&&!_.isBoolean(e.opts.value)&&e.opts.update&&e.opts.cursor?e.value=e.opts.cursor.get(e.opts.update):_.isBoolean(e.opts.value)&&e.opts.value!==e.value&&(e.value=e.opts.value))}),e.onClick=function(){o=!0,e.opts.group?e.value||(_.each(e.parent.tags,function(t,o){"ui-checkbox"==o&&_.each(t,function(t){t.opts.group==e.opts.group&&t.update({value:!1})})}),e.value=!e.value):e.value=!e.value,e.opts.commit===!0||"true"==e.opts.commit?e.parent.update():_.isFunction(e.opts.commit)?e.opts.commit.call(this,e.value,e.opts.i):e.opts.commit&&e.parent[e.opts.commit]&&e.parent[e.opts.commit](e.value,e.opts.i),e.opts.update&&e.opts.cursor&&(e.opts.group?e.opts.cursor.set(e.opts.update,e.opts.value):e.opts.cursor.set(e.opts.update,e.value)),setTimeout(function(){o=!1},5)}}),riot.tag2("ui-dropmenu",'<div if="{items && items.length}" class="dropmenu__wrapper"> <virtual each="{item in items}" no-reorder> <div if="{item && !item.divider}" onclick="{onSelect}" class="dropmenu__item"> {item.title ? item.title : item} </div> <div if="{item && item.divider}" class="dropmenu__item divider"></div> </virtual> </div>',"",'class="dropmenu" data-pos="{pos}" data-active="{active}"',function(t){var e=this,o=$$(e.root);e.active=!1,e.items=[],e.rootScroll=null,e.show=function(t){if(t&&t.elem){if(t.id||(t.id="0"),e._id&&e._id===t.id)return void e.hide();e.active&&e.hide(),t.id&&(e._id=t.id),e.pos=t.pos?t.pos:"center",e.items=t.menu,e.callback=t.callback,e.active=!0;var s=t.elem.offset(),i=0,a=0;"center"===e.pos?i=t.elem.outerWidth()/2:"left"===e.pos||"down-left"===e.pos?a=-(t.elem.outerHeight()/2):"right"!==e.pos&&"down-right"!==e.pos||(i=t.elem.outerWidth(),a=-(t.elem.outerHeight()/2)),e.rootScroll=t.rootScroll?t.rootScroll:app.$dom.root,setTimeout(function(){app.$dom.body.on("click.dropdown",function(t){e.hide()})},5),e.update(),o.css({top:e.rootScroll[0].scrollTop+s.top+t.elem.outerHeight()+"px",left:s.left+"px",marginLeft:i+"px",marginTop:a+"px"})}},e.hide=function(){app.$dom.body.off("click.dropdown"),e.active=!1,e._id&&(e._id=null),e.update()},e.onSelect=function(){var t=this.item._id||this.item;e.value=t,this.item&&_.isFunction(this.item.callback)&&this.item.callback(),e.callback&&e.callback(t||this.item)}}),riot.tag2("ui-input",'<input oninput="{onInput}" onupdate="{opts.onupdate ? opts.onupdate : ⁗none⁗}" class="input input-{opts.size ? opts.size : \'m\'}" riot-value="{value}" disabled="{typeof opts.disabled !== \'undefined\'}" placeholder="{opts.placeholder}">',"","",function(t){var e=this;e.on("before-mount",function(){e.opts.update&&e.opts.cursor?e.value=e.opts.cursor.get(e.opts.update):e.value=e.opts.value}),e.on("update",function(){!e.opts.value&&e.opts.update&&e.opts.cursor?e.value=e.opts.cursor.get(e.opts.update):e.opts.value&&e.opts.value!==e.value&&(e.value=e.opts.value)}),e.onInput=function(t){var o=t.target.value;e.opts.commit===!0||"true"==e.opts.commit?e.parent.update():_.isFunction(e.opts.commit)?e.opts.commit.call(this,o,e.opts.i):e.opts.commit&&e.parent[e.opts.commit]&&e.parent[e.opts.commit](o,e.opts.i),e.opts.update&&e.opts.cursor&&e.opts.cursor.set(e.opts.update,_.clean(o))}}),riot.tag2("ui-select",'<select onchange="{onChange}" onupdate="{opts.onupdate ? opts.onupdate : ⁗none⁗}" disabled="{disable}"> <option each="{item in opts.items}" selected="{item._id == value || item == value}" riot-value="{item._id ? item._id : item}">{item.title ? item.title : item}</option> </select>',"","class=\"select select-{opts.size ? opts.size : 'm'} {short : typeof opts.short !== 'undefined'}\"",function(t){var e=this;e.on("before-mount",function(){e.opts.update&&e.opts.cursor?e.value=e.opts.cursor.get(e.opts.update):e.value=e.opts.value,e.disable=e.opts.disable}),e.on("update",function(){!e.opts.value&&e.opts.update&&e.opts.cursor?e.value=e.opts.cursor.get(e.opts.update):e.opts.value&&e.opts.value!==e.value&&(e.value=e.opts.value),_.isBoolean(e.opts.disable)&&e.opts.disable!==e.disable&&(e.disable=e.opts.disable)}),e.onChange=function(t){var o=t.target.value;e.opts.commit===!0||"true"==e.opts.commit?e.parent.update():_.isFunction(e.opts.commit)?e.opts.commit.call(this,o,e.opts.i):e.opts.commit&&e.parent[e.opts.commit]&&e.parent[e.opts.commit](o,e.opts.i),e.opts.update&&e.opts.cursor&&e.opts.cursor.set(e.opts.update,o)}}),riot.tag2("ui-slider",'<span if="{opts.title}" class="input-title">{opts.title}</span> <input class="display-none" name="slider_input" type="range" riot-value="{opts.value}" min="{opts.min}" max="{opts.max}" step="{opts.step}" readonly="{opts.readonly}"> <input class="input input-{opts.size ? opts.size : \'m\'}" onkeyup="{onKeySlider}" name="slider_data" autocomplete="off" riot-value="{opts.value}" readonly="{opts.readonly}" type="{\'number\'}"> <div if="{opts.ed && !app.device.isPhone}" class="pos-tr c-blue fontSize-20 fontWeight-5 flex-centered w40 h100p">{opts.ed}</div>',"",'class="display-block pos-rel"',function(t){var e=this;e.input=e.slider_data,e.on("before-mount",function(){e.opts.update&&e.opts.cursor&&(e.opts.value=e.opts.cursor.get(e.opts.update))}),e.on("mount",function(){!e.opts.phone&&app.device.isPhone||(e.slider=$$(e.slider_input),e.value=e.opts.value,setTimeout(function(){e.slider.rangeslider({polyfill:!1,orientation:"horizontal",rangeClass:"rangeslider",horizontalClass:"rangeslider--horizontal",fillClass:"rangeslider-track",handleClass:"rangeslider-handle",onSlide:function(t,o){e.input.value=o,e.value=o,e.fnCommit(o)}})},5),e.slider.val(e.value),e.commit=e.opts.commit?e.opts.commit:null)}),e.change=function(t){e.slider?e.slider.val(t).change():e.input.value=t,e.value=t,e.fnCommit(t)},e.onKeySlider=function(t){var o=t.target.value;e.value=o,e.fnCommit(o)},e.fnCommit=function(t){e.commit===!0||"true"==e.commit?e.parent.update():_.isFunction(e.commit)?e.commit.call(this,t,e.opts.i):e.commit&&e.parent[e.commit]&&e.parent[e.commit](t,e.opts.i),e.opts.update&&e.opts.cursor&&e.opts.cursor.set(e.opts.update,t)},this.on("unmount",function(){e.slider&&e.slider.rangeslider("destroy")})}),riot.tag2("ui-switcher",'<div class="switch"> <input class="switch-input" type="checkbox" checked=""> <span class="switch-left">ON</span> <label class="switch-label">&nbsp;</label> <span class="switch-right">OFF</span> </div>',"",'onclick="{onClick}" onupdate="{opts.onupdate ? opts.onupdate : ⁗self⁗}" class="switcher" active="{value}"',function(t){var e=this;e.on("before-mount",function(){e.value=e.opts.value}),e.onClick=function(){e.value=!e.value,e.opts.commit===!0||"true"==e.opts.commit?e.parent.update():_.isFunction(e.opts.commit)?e.opts.commit.call(this,e.value,e.opts.i):e.opts.commit&&e.parent[e.opts.commit]&&e.parent[e.opts.commit](e.value,e.opts.i)}}),riot.tag2("ui-textarea",'<textarea oninput="{onInput}" onupdate="{opts.onupdate ? opts.onupdate : ⁗none⁗}" class="textarea textarea-{opts.size ? opts.size : \'m\'}" disabled="{typeof opts.disabled !== \'undefined\'}" placeholder="{opts.placeholder}">{value}</textarea>',"","",function(t){var e=this;e.on("before-mount",function(){e.opts.update&&e.opts.cursor?e.value=e.opts.cursor.get(e.opts.update):e.value=e.opts.value}),e.on("update",function(){!e.opts.value&&e.opts.update&&e.opts.cursor?e.value=e.opts.cursor.get(e.opts.update):e.opts.value&&e.opts.value!==e.value&&(e.value=e.opts.value)}),e.onInput=function(t){var o=t.target.value;e.opts.commit===!0||"true"==e.opts.commit?e.parent.update():_.isFunction(e.opts.commit)?e.opts.commit.call(this,o,e.opts.i):e.opts.commit&&e.parent[e.opts.commit]&&e.parent[e.opts.commit](o,e.opts.i),e.opts.update&&e.opts.cursor&&e.opts.cursor.set(e.opts.update,o)}}),riot.tag2("section-managers",'<div class="display-none row"> <div class="col-md-12"> <div class="manager__item mr-m mb-m"> <div class="manager__item__avatar"> <div class="manager__item__avatar__image" style="background-image:url(/assets/images/avatars/8.jpg)"></div> </div> <div class="manager__item__text"> <div class="manager__item__title">Дарья</div> <div class="manager__item__date mb-xs">Последний визит:<br><span class="c-blue">3 декабря 2016</span></div> <div class="manager__item__date">В системе: <strong>236 дней</strong></div> </div> <div class="manager__item__stat"> <div class="manager__item__stat__item"> Офферов: <strong>27</strong> </div> <div class="manager__item__stat__item">Заказов: <strong>16</strong></div> </div> </div> </div> <div class="col-md-12"> <div class="manager__item mr-m mb-m"> <div class="manager__item__avatar"> <div class="manager__item__avatar__image" style="background-image:url(/assets/images/avatars/9.jpg)"></div> </div> <div class="manager__item__text"> <div class="manager__item__title">Александра</div> <div class="manager__item__date mb-xs">Последний визит:<br><span class="c-blue">3 декабря 2016</span></div> <div class="manager__item__date">В системе: <strong>236 дней</strong></div> </div> <div class="manager__item__stat"> <div class="manager__item__stat__item"> Офферов: <strong>27</strong> </div> <div class="manager__item__stat__item">Заказов: <strong>16</strong></div> </div> </div> </div> <div class="col-md-12"> <div class="manager__item mr-m mb-m"> <div class="manager__item__button__create">Добавить менеджера</div> </div> </div> </div>',"","",function(t){this.on("mount",function(){})}),riot.tag2("section-offers","","","",function(t){this.on("mount",function(){})}),riot.tag2("section-orders","","","",function(t){this.on("mount",function(){})}),riot.tag2("package-edit",'<div class="c-gray fontSize-22 mb-xs text-left">Редактирование комплекта</div> <div class="rows"> <div class="row mb-xxs"> <div each="{item in $store.type.get()}" no-reorder class="col-md-8 h15"> <div class="input-title">{item.title}</div> </div> </div> </div> <div class="btn-group w100p mb-m"> <button onclick="{select.products}" each="{item in $store.type.get()}" no-reorder class="btn btn-m w33p btn-primary{product == item._id ? \'\' : \'-hover\'}"> {package.get(item._id) ? package.get(item._id) : item.title} <div if="{!package.get(item._id)}" class="btn-badge">{$store.products.getItemsByParams(get.options(item._id), items).length}</div> <div if="{package.get(item._id)}" class="btn-checked"></div> </button> </div> <div if="{product && $store.products.getItemsByParams(get.options(product), items).length}"> <div each="{item in _.sortArray($store.products.getItemsByParams(get.options(product), items), ⁗pos⁗)}" no-reorder class="product__item product__item--select {selected : package.get(product) == item.article} mb-s"> <product-item onclick="{select.product}" item="{item}"></product-item> </div> </div> <div if="{!product}"> <div class="mb-m"> <ui-input update="title" cursor="{package.select()}" placeholder="Название комплекта"></ui-input> </div> <div class="mb-m"> <ui-textarea update="text" cursor="{package.select()}" placeholder="Описание комплекта"></ui-textarea> </div> <div class="flex-row-right-center w100p"> <div class="mr-xs"> <ui-checkbox update="active" cursor="{package.select()}" title="Активный" size="l"></ui-checkbox> </div> <div onclick="{onCancel}" class="btn btn-m btn-primary-hover ml-m mr-s">Отменить</div> <div onclick="{onSave}" onupdate="self" class="btn btn-m btn-success {btn-loading: loading}">Сохранить</div> </div> </div>',"","",function(t){var e=this;e.on("before-mount",function(){e.product=null,e.items=null,e.package=new Baobab(_.isEmpty(e.opts.package)?{}:e.opts.package)}),e.on("edit",function(t){e.package.get()&&(e.product=null),e.package.set(_.copyArray(t)),e.items=$store.products.getItemsByParamsWithoutType(t)}),e.get={options:function(t){return{light:e.package.get("light"),type:t,length:e.package.get("length"),group:e.package.get("group")}}},e.select={products:function(t){e.product&&e.product==this.item._id?e.product=null:(e.product=this.item._id,e.trigger("select:products"))},product:function(t){e.package.select(e.product).set(this.item.article),e.product=null,e.trigger("select:product")}},e.onCancel=function(t){e.package.set({}),e.product=null,e.trigger("cancel")},e.onSave=function(t){e.package.get("title").length?(e.loading=!0,app.request("setPackagesItem",{id:e.package.get("_id"),item:e.package.get()}).then(function(){$store.packages.select({_id:e.package.get("_id")}).set(e.package.get()),e.trigger("save",e.package.get()),e.package.set({}),e.update({product:null,loading:!1})},function(){e.update({product:null,loading:!1}),e.trigger("cancel")})):$Notify.show({text:"Введите название комплекта"})}}),riot.tag2("package-item",'<virtual each="{type in $store.type.get()}" no-reorder> <div class="package__item__product"> <div class="package__item__product__image"> <img name="image" onerror="this.src=\'/assets/images/no_photo.png\'" riot-src="{parent.opts && parent.opts.item && parent.opts.item[type._id] ? $store.products.getImageByArticle(parent.opts.item[type._id]) : null}"> </div> <div class="package__item__product__text"> <div class="package__item__product__article">{parent.opts.item[type._id]}</div> <div class="package__item__product__title">{$store.products.getItemByArticle(parent.opts.item[type._id]).title}</div> <div class="package__item__product__price">Розница: <span>{$store.products.getItemByArticle(parent.opts.item[type._id]).price} ₽</span></div> </div> </div> </virtual>',"",'class="package__item__container"',function(t){}),riot.tag2("section-packages",'<div class="row"> <div class="col-md-8"> <div class="input-title">Тип подсветки</div> <packages-select-light></packages-select-light> <packages-create></packages-create> </div> <div class="col-md-16"> <packages-table></packages-table> </div> </div> <packages-edit></packages-edit>',"","",function(t){var e=this;$Packages=e,e.on("before-mount",function(){e.sections={light:e.tags["packages-select-light"],create:e.tags["packages-create"],table:e.tags["packages-table"],edit:e.tags["packages-edit"]},e.state=new Baobab({light:null,length:null,group:null},{autoCommit:!0}),_.bbUpdate(e.state,function(t,o,s){var i=s.data.currentData;_.every(i)&&e.sections.create.search($store.products.getItemsByParamsWithoutType(i)),e.sections.table.update()})}),e.on("mount",function(){e.state.set("light",e.sections.light.select.value)}),e.on("unmount",function(){e.state.off("update")})}),riot.tag2("packages-create",'<div class="row mb-m {display-none : _.some(package)}"> <div class="col-md-12"> <div class="select select-m"> <select name="selectLength" onchange="{select.length}"> <option value="" selected>Выберите длину</option> <option each="{item in _.range(5, 55, 5)}" riot-value="{item}" selected="{selected.length(item)}">{item} метров</option> </select> </div> </div> <div class="col-md-12"> <div class="select select-m"> <select name="selectGroup" onchange="{select.group}"> <option value="" selected>Выберите группу</option> <option each="{item in $store.group.get()}" riot-value="{item._id}" selected="{selected.group(item._id)}">{item.title}</option> </select> </div> </div> </div> <div class="{display-none : !selectLength.value.length || !selectGroup.value.length}"> <div class="btn-group w100p mb-m"> <button onclick="{select.products}" each="{item in $store.type.get()}" no-reorder class="btn btn-m w33p btn-primary{product == item._id ? \'\' : \'-hover\'}"> {package[item._id] ? package[item._id] : item.title} <div if="{!package[item._id]}" class="btn-badge">{$store.products.getItemsByParams(get.options(item._id), items).length}</div> <div if="{package[item._id]}" class="btn-checked"></div> </button> </div> <div if="{product && $store.products.getItemsByParams(get.options(product), items).length}"> <div each="{item in _.sortArray($store.products.getItemsByParams(get.options(product), items), ⁗pos⁗)}" no-reorder class="product__item product__item--select {selected : parent.package[product] == item.article} mb-s"> <product-item onclick="{select.product}" item="{item}"></product-item> </div> </div> <div if="{!product && _.some(package)}"> <input name="title" placeholder="Название комплекта" class="input input-m mb-m"> <textarea name="text" placeholder="Описание комплекта" class="textarea textarea-m mb-m"></textarea> <div class="flex-row-right-center"> <div onclick="{onReset}" class="btn btn-m btn-primary-hover mr-s">Отменить</div> <div onclick="{onSave}" onupdate="self" class="btn btn-m btn-success {btn-loading: loading, btn-disabled: !_.every(package)}">Добавить комплект</div> </div> </div> </div>',"","",function(t){
var e=this;e.on("before-mount",function(){e.onReset()}),e.onReset=function(){e.loading=!1,e.items=null,e.product=null,e.package={ledribbon:null,power:null,control:null},$Packages.sections&&$Packages.sections.light.update({disabled:!1})},e.search=function(t){e.update({items:t})},e.get={options:function(t){return{light:$Packages.state.get("light"),type:t,length:$Packages.state.get("length"),group:$Packages.state.get("group")}}},e.selected={length:function(t){return $Packages.state.get("length")==t},group:function(t){return $Packages.state.get("group")==t}},e.select={length:function(t){$Packages.state.set("length",String(t.target.value))},group:function(t){$Packages.state.set("group",t.target.value)},products:function(t){e.product&&e.product==this.item._id?e.product=null:e.product=this.item._id},product:function(t){e.package[e.product]=this.item.article,e.product=null,$Packages.sections.light.update({disabled:!0})}},e.onSave=function(){var t={_id:_.newId(),title:_.clean(e.title.value),text:_.clean(e.text.value),active:!0};_.extend(t,$Packages.state.get()),_.extend(t,e.package),t.title?(e.loading=!0,app.request("addPackages",t).then(function(){$store.packages.push(t),e.onReset(),$Packages.update()},function(){e.loading=!1,e.update()})):$Notify.show({text:"Введите название комплекта"})}}),riot.tag2("packages-edit",'<div class="oScreen__buttons" data-pos="top-right"> <div onclick="{hide}" onupdate="none" class="button__close"></div> </div> <div name="content" class="oScreen__content pt-l pb-xl bg-white"> <div class="container"> <div class="row pb-s"> <div class="col-md-24 fontSize-24 fontWeight-3 mb-xl"> {$store.light.getTitleById(path.light)} &mdash; {path.length}м &mdash; {$store.group.getTitleById(path.group)} </div> </div> <div class="row flex-row-center-stretch"> <div class="col-md-15"> <div class="row package__item__list sortable"> <div each="{item in _.sortArray(items.get(), ⁗pos⁗)}" class="sortable__item col-md-24 pb-xs" data-id="{item._id}"> <div class="package__item {selected : editing == item._id} mr-m mb-m" data-active="{item.active}"> <div class="package__item__title">{item.title}</div> <package-item onclick="{onEdit}" item="{item}"></package-item> <div class="package__item__handle"></div> <div onclick="{onRemove}" onupdate="none" class="package__item__remove"></div> </div> </div> </div> </div> <div class="col-md-9"> <div class="{display-none : editing || !items.get().length} pos-centered-v w100p plr-l pb-m fontSize-24 c-gray"> Выберите комплект для редактирования </div> <div if="{editing}" class="pl-m trY--xl pt-m"> <package-edit></package-edit> </div> </div> </div> </div> </div>',"",'class="oScreen zIndex-2" data-open="{active}" data-show="down"',function(t){var e=this,o=$$(e.root);e.items=new Baobab([]),e.editing=null,e.path=null,e.on("mount",function(){e.package=e.tags["package-edit"],e.package.on("cancel",function(){e.editing=null,e.update()}),e.package.on("save",function(t){e.items.select({_id:t._id}).set(t),e.editing=null,e.update()})}),e.show=function(t,o){e.items.set(o),e.update({path:t,active:!0}),app.$dom.body.addClass("overflow-hidden"),_.onEndTransition(e.content,function(){e.sorting.init()})},e.sorting={init:function(){e.sortable=new app.plugins.sortable(o.find(".sortable"),{handle:".package__item__handle",draggable:".sortable__item"},function(t){app.request("setPackagesSort",t).then(function(){$Notify.show({text:"Сортировка обновлена"})}),_.each(t,function(t){$store.packages.get({_id:t._id}).pos=t.pos})}),e.sortable.init()},destroy:function(){e.sortable.destroy()}},e.onEdit=function(){e.package.trigger("edit",this.item),e.editing=this.item._id},e.onRemove=function(){var t=this.item;$Alert.show({title:"Вы хотите удалить комплект?",subtitle:"Вы уверены?",success:{callback:function(){app.request("delPackages",{id:t._id}).then(function(){$store.packages.select({_id:t._id}).unset(),e.items.select({_id:t._id}).unset(),e.editing==t._id&&(e.editing=null),e.update(),$Packages.sections.table.update(),$Notify.show({text:"Комплект успешно удален"})})}}})},e.hide=function(){e.update({active:!1}),app.$dom.body.removeClass("overflow-hidden"),_.onEndTransition(e.content,function(){e.sorting.destroy(),e.editing=null})}}),riot.tag2("packages-select-light",'<select name="select" onchange="{onSelect}" onupdate="none" disabled="{disabled}"> <option each="{item in $store.light.get()}" riot-value="{item._id}">{item.title}</option> </select>',"",'class="select select-m mb-s"',function(t){$.disabled=!0,this.onSelect=function(t){$Packages.state.set("light",t.target.value)}}),riot.tag2("packages-table",'<div class="rows table"> <div class="row table__header"> <div class="col-md-8 c-blueLight"> {$store.group.get(0).title} </div> <div class="col-md-8 c-emerald"> {$store.group.get(1).title} </div> <div class="col-md-8 c-orange"> {$store.group.get(2).title} </div> </div> <div each="{item in _.range(5, 55, 5)}" no-reorder class="row table__row"> <div class="table__length"> {item}м </div> <div onclick="{select}" oncontextmenu="{edit}" onupdate="self" each="{group in $store.group.get()}" no-reorder class="col-md-8 table__item__count table__item--select {selected : selected(this)}">{get.items(this)}</div> </div> </div>',"",'class="table__wrapper"',function(t){var e=this;e.get={options:function(t){return{light:$Packages.state.get("light"),length:String(t.parent.item),group:t.group._id}},items:function(t){var o=$store.packages.getItemsByParams(e.get.options(t));return o.length?o.length:""}},e.selected=function(t){var o=e.get.options(t);return $Packages.state.get("type")==o.type&&$Packages.state.get("length")==o.length&&$Packages.state.get("group")==o.group},e.select=function(){$Packages.sections.light.disabled?$Notify.show({text:"Закончите или отмените редактирование"}):($Packages.state.set(e.get.options(this)),$Packages.sections.create.update())},e.edit=function(t){if(!$$(t.target).is(":empty")){var o=e.get.options(this);$Packages.sections.edit.show(o,$store.packages.getItemsByParams(o))}}}),riot.tag2("product-edit",'<div class="c-gray fontSize-22 mb-xs text-left">Редактирование позиции</div> <div class="product__item mb-m"> <product-item item="{product.get()}"></product-item> </div> <div class="mb-m"> <ui-textarea update="text" cursor="{product.select()}" placeholder="Описание товара"></ui-textarea> </div> <div class="inline text-right"> <div onclick="{onCancel}" class="btn btn-m btn-primary-hover mr-s">Отменить</div> <div onclick="{onSave}" onupdate="self" class="btn btn-m btn-success {btn-loading: loading}">Сохранить</div> </div>',"","",function(t){var e=this;e.on("before-mount",function(){e.product=new Baobab(_.isEmpty(e.opts.product)?{}:e.opts.product)}),e.on("edit",function(t){e.product.set(_.copyArray(t))}),e.onCancel=function(t){e.product.set({}),e.trigger("cancel")},e.onSave=function(t){e.loading=!0,app.request("setProductsItem",{article:e.product.get("article"),text:e.product.get("text")}).then(function(){var t=e.product.get("article"),o=e.product.get("text");_.each(_.where($store.products.get(),{article:t}),function(t){t.text=o}),e.trigger("save",e.product.get()),e.product.set({}),e.update({loading:!1})},function(){e.loading=!1,e.update()})}}),riot.tag2("product-item",'<div class="product__item__image"> <img name="image" onerror="this.src=\'/assets/images/no_photo.png\'" riot-src="{opts.item && opts.item.article ? $store.products.getImageByArticle(opts.item.article) : null}"> </div> <div class="product__item__text"> <div class="product__item__article">{opts.item.article}</div> <div class="product__item__title">{opts.item.title}</div> <div class="product__item__price">Розница: <span>{opts.item.price} ₽</span></div> </div> <div if="{opts.item && opts.item.color}" class="product__item__colors"> <div each="{item in opts.item.related}" no-reorder class="product__item__colors__items" data-items="{item.color.split(\'|\').length}" data-color="{item.color}" data-related="true"> <div each="{color in item.color.split(\'|\')}" no-reorder class="product__item__color color-{color}"></div> </div> <div class="product__item__colors__items" data-items="1" data-color="{opts.item.color}" data-related="false"> <div each="{color in opts.item.color.split(\'|\')}" no-reorder class="product__item__color color-{color}"></div> </div> </div>',"",'class="product__item__container"',function(t){}),riot.tag2("section-products",'<div class="row"> <div class="col-md-8"> <div class="input-title">Тип подсветки</div> <div class="select select-m mb-s"> <select name="selectLight" onchange="{select.light}" onupdate="none"> <option each="{item in $store.light.get()}" riot-value="{item._id}">{item.title}</option> </select> </div> <products-create></products-create> </div> <div class="col-md-16"> <products-table></products-table> </div> </div> <products-edit></products-edit>',"","",function(t){var e=this;$Products=e,e.on("before-mount",function(){e.sections={create:e.tags["products-create"],table:e.tags["products-table"],edit:e.tags["products-edit"]},e.state=new Baobab({light:null,type:null,length:null,group:null},{autoCommit:!0}),_.bbUpdate(e.state,function(t,o,s){e.sections.table.update()})}),e.on("mount",function(){e.state.set("light",e.selectLight.value)}),e.select={light:function(t){e.state.set("light",t.target.value)}},e.on("unmount",function(){e.state.off("update")})}),riot.tag2("products-create",'<div class="{display-none : product}"> <products-search></products-search> </div> <div class="{display-none : !product}"> <div class="product__item mb-m"> <div if="{exist.product()}" class="product__item__badge">добавлен</div> <product-item item="{product}"></product-item> </div> <div class="row mb-m"> <div class="col-md-12"> <div class="select select-m"> <select name="selectType" onchange="{select.type}"> <option value="" selected>Выберите тип</option> <option each="{item in $store.type.get()}" riot-value="{item._id}" selected="{selected.type(item._id)}">{item.title}</option> </select> </div> </div> <div class="col-md-12"> <div class="select select-m"> <select name="selectLength" onchange="{select.length}"> <option value="" selected>Выберите длину</option> <option each="{item in _.range(5, 55, 5)}" riot-value="{item}" selected="{selected.length(item)}">{item} метров</option> </select> </div> </div> </div> <div class="select select-m mb-m"> <select name="selectGroup" onchange="{select.group}"> <option value="" selected>Выберите ценовую группу</option> <option each="{item in $store.group.get()}" riot-value="{item._id}" selected="{selected.group(item._id)}">{item.title}</option> </select> </div> <div class="mb-m"> <textarea class="textarea textarea-m" name="text" placeholder="Описание товара"></textarea> </div> <div class="inline text-right"> <div onclick="{onReset}" class="btn btn-m btn-primary-hover mr-s">Выбрать другой</div> <div onclick="{onSave}" onupdate="self" class="btn btn-m btn-success {btn-disabled : exist.product() || !selectType.value.length || !selectLength.value.length || !selectGroup.value.length, btn-loading: loading}">Добавить товар</div> </div> </div>',"","",function(t){var e=this;e.product=null,e.loading=!1,e.on("mount",function(){e.search=riot.mount("products-search",{tags:{placeholder:"Начните вводить артикул",filter:"article",options:$store.data.get()}}),e.search[0].on("select",function(t){t&&(e.product=t,e.update())})}),e.selected={type:function(t){return $Products.state.get("type")==t},length:function(t){return $Products.state.get("length")==t},group:function(t){return $Products.state.get("group")==t}},e.select={type:function(t){$Products.state.set("type",t.target.value)},length:function(t){$Products.state.set("length",String(t.target.value))},group:function(t){$Products.state.set("group",t.target.value)}},e.exist={product:function(){return!!e.product&&$store.products.existItemsByParamsWithoutGroup($Products.state.get(),e.product.article)}},e.onSave=function(){if(e.tags["product-item"].image.getAttribute("src").match(/no_photo/))$Notify.show({text:"Выберите товар с фотографией"});else{e.loading=!0;var t={_id:_.newId(),text:_.clean(e.text.value)};_.extend(t,e.product),_.extend(t,$Products.state.get()),app.request("addProducts",t).then(function(){$store.products.push(t),e.loading=!1,e.onReset(),$Products.update()},function(){e.loading=!1,e.update()})}},e.onReset=function(){e.product=null}}),riot.tag2("products-edit",'<div class="oScreen__buttons" data-pos="top-right"> <div onclick="{hide}" onupdate="none" class="button__close"></div> </div> <div name="content" class="oScreen__content pt-l pb-xl bg-white"> <div class="container"> <div class="row pb-s"> <div class="col-md-24 fontSize-24 fontWeight-3 mb-xl"> {$store.light.getTitleById(path.light)} &mdash; {$store.type.getTitleById(path.type)} &mdash; {path.length}м &mdash; {$store.group.getTitleById(path.group)} </div> </div> <div class="row flex-row-center-stretch"> <div class="col-md-15"> <div class="row product__item__list sortable"> <div each="{item in _.sortArray(items.get(), ⁗pos⁗)}" class="sortable__item col-md-12" data-id="{item._id}"> <div class="product__item {selected : editing == item._id} mr-m mb-m"> <product-item onclick="{onEdit}" item="{item}"></product-item> <div class="product__item__handle"></div> <div onclick="{onRemove}" onupdate="none" class="product__item__remove"></div> </div> </div> </div> </div> <div class="col-md-9"> <div class="{display-none : editing || !items.get().length} pos-centered-v w100p plr-l pb-m fontSize-24 c-gray"> Выберите товар для редактирования </div> <div class="{display-none : !editing} pl-m trY--l"> <product-edit></product-edit> </div> </div> </div> </div> </div>',"",'class="oScreen zIndex-2" data-open="{active}" data-show="down"',function(t){var e=this,o=$$(e.root);e.items=new Baobab([]),e.editing=null,e.path=null,e.on("mount",function(){e.product=e.tags["product-edit"],e.product.on("cancel",function(){e.editing=null,e.update()}),e.product.on("save",function(t){e.items.select({_id:t._id}).set(t),e.editing=null,e.update()})}),e.show=function(t,o){e.items.set(o),e.update({path:t,active:!0}),app.$dom.body.addClass("overflow-hidden"),_.onEndTransition(e.content,function(){e.sorting.init()})},e.sorting={init:function(){e.sortable=new app.plugins.sortable(o.find(".sortable"),{handle:".product__item__handle",draggable:".sortable__item"},function(t){app.request("setProductsSort",t).then(function(){$Notify.show({text:"Сортировка обновлена"})}),_.each(t,function(t){$store.products.get({_id:t._id}).pos=t.pos})}),e.sortable.init()},destroy:function(){e.sortable.destroy()}},e.onEdit=function(){e.product.trigger("edit",this.item),e.editing=this.item._id},e.onRemove=function(){var t=this.item,o={light:t.light,length:t.length,group:t.group};o[t.type]=t.article,$store.packages.select(o).get()?$Notify.show({color:"danger",text:"Этот товар удалить нельзя, он уже используется в комплекте"}):$Alert.show({title:"Вы хотите удалить товар?",subtitle:"Вы уверены?",success:{callback:function(){app.request("delProducts",{ids:[t._id]}).then(function(){$store.products.select({_id:t._id}).unset(),e.items.select({_id:t._id}).unset(),e.editing==t._id&&(e.editing=null),e.update(),$Products.sections.table.update(),$Notify.show({text:"Товар успешно удален"})})}}})},e.hide=function(){e.update({active:!1}),app.$dom.body.removeClass("overflow-hidden"),_.onEndTransition(e.content,function(){e.sorting.destroy(),e.editing=null})}}),riot.tag2("products-table",'<div class="rows table"> <div class="row table__header"> <div class="col-md-8"> {$store.type.get(0).title} </div> <div class="col-md-8"> {$store.type.get(1).title} </div> <div class="col-md-8"> {$store.type.get(2).title} </div> </div> <div each="{item in _.range(5, 55, 5)}" no-reorder class="row table__row"> <div class="table__length"> {item}м </div> <div each="{type in $store.type.get()}" no-reorder class="col-md-8"> <div class="table__items"> <div onclick="{select}" oncontextmenu="{dropmenu}" onupdate="self" each="{group in $store.group.get()}" no-reorder class="table__item table__item--select {selected : selected(this)}" data-item="{group._id}">{get.items(this)}</div> </div> </div> </div> </div>',"",'class="table__wrapper"',function(t){var e=this;e.get={options:function(t){return{light:$Products.state.get("light"),type:t.parent._item.type._id,length:String(t.parent.item),group:t.group._id}},items:function(t){var o=$store.products.getItemsByParams(e.get.options(t));return o.length?o.length:""}},e.selected=function(t){var o=e.get.options(t);return $Products.state.get("type")==o.type&&$Products.state.get("length")==o.length&&e.parent.state.get("group")==o.group},e.select=function(){$Products.state.set(e.get.options(this)),$Products.sections.create.update()},e.action={copy:function(t){Store.set("bufferProducts",$store.products.getItemsByParams(t))},paste:function(t){var o=Store.get("bufferProducts");if(o&&o.length){var s=[];_.each(o,function(e,o){_.extend(e,t),e._id=_.newId()+o,e.light=$Products.state.get("light"),s.push($store.products.existItemsByParamsWithoutGroup(t,e.article))}),_.some(s)?$Notify.show({color:"danger",text:"Одни из добавляемых товаров, уже присутствуют в выбранной линейке"}):app.request("addProducts",o).then(function(){$store.products.concat(o),e.update()})}},clear:function(t){var o=$store.products.getItemsByParams(t),s=_.pluck(o,"_id"),i=[];delete t.type,_.each(o,function(e,o){var s=_.copyArray(t);s[e.type]=e.article,i.push($store.packages.select(t).get())}),_.some(i)?$Notify.show({color:"danger",text:"Одни из товаров удалить нельзя, они уже используется в комплекте"}):app.request("delProducts",{ids:s}).then(function(){_.each(s,function(t){$store.products.select({_id:t}).unset()}),e.update()})},edit:function(t){$Products.sections.edit.show(t,$store.products.getItemsByParams(t))}},e.dropmenu=function(t){var o=$$(t.target),s=e.get.options(this),i=o.is(":empty"),a=[];Store.get("bufferProducts")&&a.push({title:"Вставить",callback:function(){i?e.action.paste(s):$Alert.show({title:"Заменить товары новыми?",subtitle:"В этой ячейке уже есть товары",success:{callback:function(){e.action.clear(s),e.action.paste(s)}}})}}),i||a.push({title:"Скопировать",callback:function(){e.action.copy(s)}},{title:"Редактировать",callback:function(){e.action.edit(s)}},{title:"Очистить ячейку",callback:function(){$Alert.show({title:"Удалить все товары в ячейке?",subtitle:"Очистить ячейку",success:{callback:function(){e.action.clear(s)}}})}}),$DropMenu.show({id:JSON.stringify(s),elem:o,pos:"down-left",menu:a})}}),riot.tag2("icon-email",'<svg class="icon-email {opts.size ? \'icon-\' + opts.size : \'icon-m\'}" fill-color="{opts.color ?   opts.color : \'blue\'}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewbox="0 0 100 125" style="enable-background:new 0 0 100 100;" xml:space="preserve"><path d="M94,31.8c-0.9-1.2-2.3-1.8-3.9-1.8H37.9H5v3.1h27.2c-0.5,0.7-0.9,1.5-1.2,2.4l-1.1,3.9H12v3.1h17.1L26.8,51h-8v3h7.1 l-2.7,9.7c-0.4,1.6-0.2,3.3,0.7,4.4c0.9,1.2,2.3,1.8,3.9,1.8h52.8c3.1,0,6.1-2.4,6.9-5.5l7.2-28.3C95.2,34.6,94.9,33,94,31.8z M84.6,63.7c-0.4,1.7-2.2,3.2-3.9,3.2H27.8c-0.6,0-1.1-0.2-1.4-0.6s-0.4-1.1-0.2-1.8l5.9-21.4l20.4,9.6c1.8,0.8,3.9,1.3,6,1.3 s4.4-0.4,6.6-1.3l24.8-9.3L84.6,63.7z M91.8,35.5l-1.1,4.3L63.9,49.9c-3.6,1.4-7.4,1.4-10.2,0.1l-20.8-9.9l1.1-3.8 c0.5-1.7,2.3-3.2,4-3.2h52.2c0.6,0,1.1,0.2,1.4,0.6C91.9,34.1,92,34.8,91.8,35.5z"></path></svg>',"",'class="icon"',function(t){}),riot.tag2("icon-gallery",'<svg class="icon-gallery {opts.size ? \'icon-\' + opts.size : \'icon-m\'}" fill-color="{opts.color ?   opts.color : \'blue\'}" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 50 50"> <path d="M 15 2 C 7.832 2 2 7.832 2 15 L 2 35 C 2 42.168 7.832 48 15 48 L 35 48 C 42.168 48 48 42.168 48 35 L 48 15 C 48 7.832 42.168 2 35 2 L 15 2 z M 38 10 C 39.105 10 40 10.895 40 12 C 40 13.105 39.105 14 38 14 C 36.895 14 36 13.105 36 12 C 36 10.895 36.895 10 38 10 z M 25 13 C 31.617 13 37 18.383 37 25 C 37 31.617 31.617 37 25 37 C 18.383 37 13 31.617 13 25 C 13 18.383 18.383 13 25 13 z M 25 15 C 19.486 15 15 19.486 15 25 C 15 30.514 19.486 35 25 35 C 30.514 35 35 30.514 35 25 C 35 19.486 30.514 15 25 15 z"></path> </svg>',"",'class="icon"',function(t){}),riot.tag2("icon-help",'<svg class="icon-help {opts.size ? \'icon-\' + opts.size : \'icon-m\'}" fill-color="{opts.color ?   opts.color : \'blue\'}" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 50 50"> <path d="M 25 0 C 11.204726 0 0 11.204726 0 25 C 0 38.795274 11.204726 50 25 50 C 38.795274 50 50 38.795274 50 25 C 50 11.204726 38.795274 0 25 0 z M 25 2 C 37.714394 2 48 12.285606 48 25 C 48 37.714394 37.714394 48 25 48 C 12.285606 48 2 37.714394 2 25 C 2 12.285606 12.285606 2 25 2 z M 25.28125 12.5 C 21.55125 12.5 19.07025 14.77575 18.53125 18.21875 C 18.49625 18.43475 18.62775 18.55775 18.84375 18.59375 L 21.09375 19 C 21.30975 19.036 21.464 18.93375 21.5 18.71875 C 21.93 16.53075 23.21075 15.3125 25.21875 15.3125 C 27.26375 15.3125 28.6875 16.61225 28.6875 18.65625 C 28.6875 19.87625 28.254 20.68525 27 22.40625 L 24.59375 25.71875 C 23.84075 26.75975 23.53125 27.5015 23.53125 28.9375 L 23.53125 30.40625 C 23.53125 30.62125 23.69125 30.754 23.90625 30.75 L 26.25 30.75 C 26.465 30.75 26.625 30.62125 26.625 30.40625 L 26.625 29.25 C 26.625 28.031 26.8455 27.5305 27.5625 26.5625 L 29.9375 23.28125 C 31.1575 21.59525 31.78125 20.31575 31.78125 18.59375 C 31.78125 15.04275 29.15325 12.5 25.28125 12.5 z M 23.71875 33.5 C 23.50275 33.5 23.34375 33.62875 23.34375 33.84375 L 23.34375 36.9375 C 23.34375 37.1525 23.50175 37.28125 23.71875 37.28125 L 26.4375 37.28125 C 26.6515 37.28125 26.8125 37.1535 26.8125 36.9375 L 26.8125 33.84375 C 26.8125 33.62975 26.6525 33.5 26.4375 33.5 L 23.71875 33.5 z"></path> </svg>',"",'class="icon"',function(t){}),riot.tag2("icon-order",'<svg class="icon-order {opts.size ? \'icon-\' + opts.size : \'icon-m\'}" fill-color="{opts.color ?   opts.color : \'blue\'}" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" viewbox="0 0 8.4666665 10.583333625" version="1.1" x="0px" y="0px"><g transform="translate(0,-288.53332)"><path d="m 1.1916157,289.85624 c -0.1777101,-8.6e-4 -0.1777101,0.26642 0,0.26556 l 0.6693806,0 c 0.1705478,0 0.3210095,0.10941 0.3741719,0.27331 l 0.9042055,2.78893 -0.4319748,0.30225 c -0.11712,0.082 -0.1971447,0.21827 -0.1971499,0.37871 l 0,0.0253 c 0,0.25397 0.2087267,0.46292 0.4624248,0.46292 l 4.4240018,0 c 0.1919325,0.0172 0.1919325,-0.28074 0,-0.26349 l -4.4240018,0 c -0.1110008,0 -0.1992142,-0.0885 -0.1992142,-0.19943 l 0,-0.0253 c 1.5e-6,-0.0551 0.050276,-0.13707 0.086189,-0.16223 l 0.4877136,-0.34151 3.1714291,0 c 0.1709888,0 0.322182,-0.11045 0.3746881,-0.27331 L 7.511766,291.1701 c 0.081336,-0.25239 -0.1113557,-0.51924 -0.3762363,-0.51924 l -3.8330681,0 c -0.1919327,-0.0172 -0.1919327,0.28075 0,0.2635 l 3.8330681,0 c 0.092157,0 0.1531816,0.0842 0.1243799,0.1736 l -0.1145738,0.35546 -3.3262591,0 c -0.1768281,0.009 -0.1628958,0.27484 0.013934,0.26556 l 3.2266519,0 -0.170829,0.52958 -2.5407559,0 c -0.1623886,0.0204 -0.1501964,0.25977 0.013419,0.26349 l 2.4426987,0 -0.1625712,0.50375 c -0.017799,0.0552 -0.065963,0.092 -0.1228317,0.092 l -3.1306572,0 -0.9011092,-2.78479 c -0.08801,-0.27139 -0.3415581,-0.45677 -0.6260296,-0.45677 z"></path><path d="m 3.7002518,294.61869 c -0.290307,0 -0.5286119,0.23858 -0.5286156,0.5292 -3.6e-6,0.29062 0.2383036,0.52918 0.5286156,0.52918 0.2903121,0 0.5266686,-0.23856 0.526665,-0.52918 -3.7e-6,-0.29062 -0.236358,-0.5292 -0.526665,-0.5292 z m 0,0.26362 c 0.1475008,0 0.2633306,0.11792 0.2633325,0.26558 1.8e-6,0.14766 -0.1158289,0.26361 -0.2633325,0.26361 -0.1475035,0 -0.2652849,-0.11595 -0.2652831,-0.26361 1.9e-6,-0.14766 0.1177823,-0.26558 0.2652831,-0.26558 z"></path><path d="m 6.3413789,294.61869 c -0.290307,0 -0.5286119,0.23858 -0.5286156,0.5292 -3.6e-6,0.29062 0.2383035,0.52918 0.5286156,0.52918 0.290312,0 0.5286192,-0.23856 0.5286155,-0.52918 -3.6e-6,-0.29062 -0.2383085,-0.5292 -0.5286155,-0.5292 z m 0,0.26362 c 0.1475008,0 0.2652812,0.11792 0.2652831,0.26558 1.8e-6,0.14766 -0.1177796,0.26361 -0.2652831,0.26361 -0.1475036,0 -0.2633343,-0.11595 -0.2633325,-0.26361 1.9e-6,-0.14766 0.1158317,-0.26558 0.2633325,-0.26558 z"></path></g></svg>',"",'class="icon"',function(t){}),riot.tag2("icon-phone",'<svg class="icon-phone {opts.size ? \'icon-\' + opts.size : \'icon-m\'}" fill-color="{opts.color ?   opts.color : \'blue\'}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewbox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M31.126,42.766c-1.342-5.693,11.38-11.721,9.041-19.423c-1.87-6.145-13.118-19.352-21.441-12.065 c-8.327,7.286-15.348,28.88,12.23,57.242c27.579,28.355,48.39,18.991,53.075,15.09s8.629-10.645,5.983-14.574 c-2.803-4.167-10.336-11.204-15.359-10.699c-5.001,0.501-6.768,3.856-10.395,7.576c-3.636,3.724-7.029,5.729-13.009,0 C45.263,60.189,32.143,47.086,31.126,42.766z"></path></svg>',"",'class="icon"',function(t){}),riot.tag2("icon-votes",'<svg class="icon-votes {opts.size ? \'icon-\' + opts.size : \'icon-m\'}" fill-color="{opts.color ?   opts.color : \'blue\'}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewbox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve"><g><polygon points="32.111,6.24 37.405,16.969 49.245,18.689 40.678,27.041 42.701,38.833 32.111,33.264 21.521,38.833 23.544,27.041 14.976,18.689 26.816,16.969 "></polygon><polygon points="33.351,41.639 37.982,49.781 47.316,50.584 41.002,57.504 43.123,66.63 34.59,62.764 26.567,67.601 27.608,58.289 20.528,52.154 29.704,50.267 "></polygon><polygon points="51.607,67.447 55.256,73.158 62.028,73.391 57.724,78.625 59.596,85.14 53.287,82.662 47.67,86.456 48.076,79.691 42.732,75.521 49.293,73.817 "></polygon><polygon points="71.423,81.543 73.914,84.924 78.112,84.787 75.667,88.201 77.094,92.15 73.091,90.881 69.775,93.46 69.746,89.26 66.271,86.903 70.256,85.578 "></polygon><polygon points="85.372,88.867 86.634,90.004 88.285,89.61 87.594,91.159 88.479,92.607 86.791,92.429 85.69,93.72 85.336,92.058 83.77,91.408 85.238,90.561 "></polygon></g></svg>',"",'class="icon"',function(t){}),riot.tag2("icon-wallet",'<svg class="icon-wallet {opts.size ? \'icon-\' + opts.size : \'icon-m\'}" fill-color="{opts.color ?   opts.color : \'blue\'}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewbox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve"><g><path d="M68.581,35.952H31.419c-1.328,0-2.563,0.395-3.604,1.065c1.319-2.422,3.721-4.489,6.407-5.21l22.698-6.092 c2.562-0.688,4.927-0.524,6.173,0.432c0.526,0.403,0.781,0.901,0.781,1.523v5.125h2v-5.125c0-1.25-0.541-2.325-1.564-3.11 c-1.754-1.345-4.711-1.636-7.909-0.777l-22.698,6.092c-4.938,1.325-8.954,6.252-8.954,10.982v1.763v6.049v21.362 c0,3.678,2.992,6.669,6.669,6.669h37.161c3.678,0,6.669-2.991,6.669-6.669V42.622C75.25,38.944,72.258,35.952,68.581,35.952z M73.25,70.033c0,2.574-2.095,4.669-4.669,4.669H31.419c-2.575,0-4.669-2.095-4.669-4.669V48.671v-6.049 c0-2.575,2.095-4.669,4.669-4.669h37.161c2.575,0,4.669,2.095,4.669,4.669V70.033z"></path><circle cx="66.813" cy="56.327" r="3.188"></circle></g></svg>',"",'class="icon"',function(t){});